# #######################################################################################################################################
# #######################################################################################################################################
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: front-end-ingress
  namespace: profile-site
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/limit-rps: "10"
spec:
  tls:
  - hosts:
    - "*.shahdevelopment.tech"
    secretName: wildcard-certificate
  rules:
    - host: kubernetes.shahdevelopment.tech
      http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: front-end-service
              port:
                number: 3000
# ####################################################################################################################################
---
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: front-end-ingress2
#   namespace: profile-site
#   annotations:
#     nginx.ingress.kubernetes.io/rewrite-target: /
#     kubernetes.io/ingress.class: nginx
# spec:
#   tls:
#   - hosts:
#     - "*.shahdevelopment.tech"
#     secretName: wildcard-certificate
#   rules:
#     - host: k8.shahdevelopment.tech
#       http:
#         paths:
#         - path: /
#           pathType: Prefix
#           backend:
#             service:
#               name: front-end-service
#               port:
#                 number: 3000
# ---
# ##################################################################################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: back-end-ingress
  namespace: profile-site
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/limit-rps: "10" # Limit to 10 requests per second per client IP
    # nginx.ingress.kubernetes.io/whitelist-source-range-by-header: "X-Real-IP, X-Forwarded-For"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      if ($http_origin !~* (^https?://(k8-backend\.shahdevelopment\.tech|kubernetes\.shahdevelopment\.tech|shahdevelopment\.tech)$)) {
        return 302 https://kubernetes.shahdevelopment.tech/blocked;
      }
      add_header 'Access-Control-Allow-Origin' "$http_origin" always;
      add_header 'Access-Control-Allow-Methods' 'GET, POST, DELETE, OPTIONS' always;
      add_header 'Access-Control-Allow-Headers' 'Authorization, X-Requested-With, Content-Type' always;
spec:
  tls:
  - hosts:
    - "*.shahdevelopment.tech"
    secretName: wildcard-certificate
  rules:
    - host: k8-backend.shahdevelopment.tech
      http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: back-end-service
              port:
                number: 9000
        - pathType: Prefix
          path: /pg
          backend:
            service:
              name: back-end-pg
              port:
                number: 5432
        # - pathType: Prefix
        #   path: /memcache
        #   backend:
        #     service:
        #       name: back-end-memcache
        #       port:
        #         number: 11211
        - pathType: Prefix
          path: /rabbit
          backend:
            service:
              name: back-end-rabbit
              port:
                number: 15674
                  
                  
                  
                  
                  

  # ---
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: back-end-memcache
#   namespace: profile-site
#   annotations:
#     nginx.ingress.kubernetes.io/rewrite-target: /
#     kubernetes.io/ingress.class: nginx
#     nginx.ingress.kubernetes.io/limit-rps: "10" # Limit to 10 requests per second per client IP
#     # nginx.ingress.kubernetes.io/whitelist-source-range-by-header: "X-Real-IP, X-Forwarded-For"
#     nginx.ingress.kubernetes.io/configuration-snippet: |
#       if ($http_origin !~* (^https?://(k8-backend\.shahdevelopment\.tech|kubernetes\.shahdevelopment\.tech|shahdevelopment\.tech)$)) {
#         return 302 https://kubernetes.shahdevelopment.tech/blocked;
#       }
#       add_header 'Access-Control-Allow-Origin' "$http_origin" always;
#       add_header 'Access-Control-Allow-Methods' 'GET, POST, DELETE, OPTIONS' always;
#       add_header 'Access-Control-Allow-Headers' 'Authorization, X-Requested-With, Content-Type' always;
# spec:
#   tls:
#   - hosts:
#     - "*.shahdevelopment.tech"
#     secretName: wildcard-certificate
#   rules:
#     - host: k8-backend.shahdevelopment.tech
#       http:
#         paths:
#         - path: /
#           pathType: Prefix
#           backend:
#             service:
#               name: back-end-service
#               port:
#                 number: 9000
# ---
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: back-end-pg
#   namespace: profile-site
#   annotations:
#     nginx.ingress.kubernetes.io/rewrite-target: /
#     kubernetes.io/ingress.class: nginx
#     nginx.ingress.kubernetes.io/limit-rps: "10" # Limit to 10 requests per second per client IP
#     # nginx.ingress.kubernetes.io/whitelist-source-range-by-header: "X-Real-IP, X-Forwarded-For"
#     nginx.ingress.kubernetes.io/configuration-snippet: |
#       if ($http_origin !~* (^https?://(k8-backend\.shahdevelopment\.tech|kubernetes\.shahdevelopment\.tech|shahdevelopment\.tech)$)) {
#         return 302 https://kubernetes.shahdevelopment.tech/blocked;
#       }
#       add_header 'Access-Control-Allow-Origin' "$http_origin" always;
#       add_header 'Access-Control-Allow-Methods' 'GET, POST, DELETE, OPTIONS' always;
#       add_header 'Access-Control-Allow-Headers' 'Authorization, X-Requested-With, Content-Type' always;
# spec:
#   tls:
#   - hosts:
#     - "*.shahdevelopment.tech"
#     secretName: wildcard-certificate
#   rules:
#     - host: k8-pg.shahdevelopment.tech
#       http:
#         paths:
#         - path: /
#           pathType: Prefix
#           backend:
#             service:
#               name: back-end-service
#               port:
#                 number: 9000
# ---
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: back-end-rabbit
#   namespace: profile-site
#   annotations:
#     nginx.ingress.kubernetes.io/rewrite-target: /
#     kubernetes.io/ingress.class: nginx
#     nginx.ingress.kubernetes.io/limit-rps: "10" # Limit to 10 requests per second per client IP
#     # nginx.ingress.kubernetes.io/whitelist-source-range-by-header: "X-Real-IP, X-Forwarded-For"
#     nginx.ingress.kubernetes.io/configuration-snippet: |
#       if ($http_origin !~* (^https?://(k8-backend\.shahdevelopment\.tech|kubernetes\.shahdevelopment\.tech|shahdevelopment\.tech)$)) {
#         return 302 https://kubernetes.shahdevelopment.tech/blocked;
#       }
#       add_header 'Access-Control-Allow-Origin' "$http_origin" always;
#       add_header 'Access-Control-Allow-Methods' 'GET, POST, DELETE, OPTIONS' always;
#       add_header 'Access-Control-Allow-Headers' 'Authorization, X-Requested-With, Content-Type' always;
# spec:
#   tls:
#   - hosts:
#     - "*.shahdevelopment.tech"
#     secretName: wildcard-certificate
#   rules:
#     - host: k8-rabbit.shahdevelopment.tech
#       http:
#         paths:
#         - path: /
#           pathType: Prefix
#           backend:
#             service:
#               name: back-end-service
#               port:
#                 number: 9000
# #######################################################################################################################################
# #######################################################################################################################################